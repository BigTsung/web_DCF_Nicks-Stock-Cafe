<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>DCF 估值計算 — Nick's Stock Cafe</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="container">
      <h1>DCF 估值計算 — Nick's Stock Cafe</h1>
      <p class="subtitle">輸入參數以估算公司合理價值與股價</p>
    </header>

    <main class="container">
      <section class="grid">
        <!-- 左：估值模型假設（span-6） -->
        <div class="section-card span-6">
          <h3 class="form-section">估值模型假設</h3>
          <div class="group">
            <div class="row header green" id="companyRow">
            <label for="company" class="label-required"><strong>Company</strong></label>
              <input id="company" type="text" placeholder="公司代號" />
            </div>
            <div class="row green" id="g15Row">
              <label for="g15" class="label-required">未來成長率（1~5年）%</label>
              <input id="g15" type="number" step="0.1" placeholder="" />
            </div>
            <div class="row green" id="gperpRow">
              <label for="gperp" class="label-required">永久成長率（終值）%</label>
              <input id="gperp" type="number" step="0.1" placeholder="" />
            </div>
            <div class="row yellow" id="waccRow">
              <label for="wacc">折現率（WACC）%</label>
              <input id="wacc" type="number" step="0.1" placeholder="可留空" />
            </div>
            <div class="row green" id="reqReturnRow">
              <label for="reqReturn" class="label-required">期望折現率（期望收益率）%</label>
              <input id="reqReturn" type="number" step="0.1" placeholder="" />
            </div>
            <div class="row yellow" id="hist5Row">
              <label for="hist5">過去五年成長率（資訊）%</label>
              <input id="hist5" type="number" step="0.1" placeholder="可留空" />
            </div>
            <div class="row blue" id="g610Row">
              <label for="g610" class="label-required">二階成長率（6~10年）%</label>
              <input id="g610" type="number" step="0.1" placeholder="" />
            </div>
          </div>
        </div>

        <!-- 右：財務基準與成長假設（span-6） -->
        <div class="section-card span-6">
          <h3 class="form-section">財務基準與成長假設</h3>
          <!-- <div class="unit-note">Units: Millions USD</div> -->
          <div class="group">
            <div class="row header green" id="revenueRow">
              <label for="revenue" class="label-required"><strong>TTM Revenue</strong><span class="unit-tag">Millions USD</span></label>
              <input id="revenue" type="number" step="0.01" placeholder="" />
            </div>
            <div class="row green" id="revG15Row">
              <label for="revG15" class="label-required">營收成長（y1-5）%</label>
              <input id="revG15" type="number" step="0.1" placeholder="" />
            </div>
            <div class="row green" id="revG610Row">
              <label for="revG610" class="label-required">營收成長（y6-10）%</label>
              <input id="revG610" type="number" step="0.1" placeholder="" />
            </div>
            <div class="row yellow" id="fcfMarginRow">
              <label for="fcfMargin">ATH FCF M（自由現金流率）%</label>
              <input id="fcfMargin" type="number" step="0.1" placeholder="" />
            </div>
            <!-- 補齊空白列，讓本區與左側欄位數一致（共 7 列） -->
            <div class="row placeholder"><label></label><input type="text" disabled aria-hidden="true" /></div>
            <div class="row placeholder"><label></label><input type="text" disabled aria-hidden="true" /></div>
            <div class="row placeholder"><label></label><input type="text" disabled aria-hidden="true" /></div>
          </div>
        </div>

        <!-- 下：股權價值計算參數（span-12） -->
        <div class="section-card span-12">
          <h3 class="form-section">股權價值計算參數</h3>
          <!-- <div class="unit-note">所有金額與股數的單位：Millions USD</div> -->
          <div class="group">
            <div class="row green" id="fcfYear1Row">
              <label for="fcfYear1" class="label-required">自由現金流（第一年，手動）<span class="unit-tag">Millions USD</span></label>
              <input id="fcfYear1" type="number" step="0.01" placeholder="" />
            </div>
            <div class="row pink" id="cashRow">
              <label for="cash" class="label-required">現金及其他投資<span class="unit-tag">Millions USD</span></label>
              <input id="cash" type="number" step="0.01" placeholder="" />
            </div>
            <div class="row pink" id="debtRow">
              <label for="debt" class="label-required">總負債<span class="unit-tag">Millions USD</span></label>
              <input id="debt" type="number" step="0.01" placeholder="" />
            </div>
            <div class="row pink" id="sharesRow">
              <label for="shares" class="label-required">流通在外股數<span class="unit-tag">Millions</span></label>
              <input id="shares" type="number" step="0.0001" placeholder="" />
            </div>
            <div class="row pink" id="startYearRow">
              <label for="startYear" class="label-required">起始年份</label>
              <input id="startYear" type="number" step="1" value="" placeholder="預設為今年" />
            </div>
            <div class="row pink" id="marketPriceRow">
              <label for="marketPrice" class="label-required">股票當前價格</label>
              <input id="marketPrice" type="number" step="0.01" placeholder="" />
            </div>
          </div>
        </div>
      </section>

      <section class="actions">
        <button id="calcBtn">計算估值</button>
        <button id="resetBtn" class="secondary">清除</button>
        <button id="exampleBtn" class="secondary">載入GOOGL範例</button>
      </section>

      

      <section id="results" class="results hidden">
        <h2>結果</h2>
        <!-- 簡化：暫不顯示細項彙總（起始FCF/現值總和/終值/EV/股權/每股合理價） -->

        <div class="cards">
          <div class="card fair">
            <div class="title">合理價</div>
            <div class="value" id="resFairCard">—</div>
          </div>
          <div class="card market">
            <div class="title">市價</div>
            <div class="value" id="resMarketCard">—</div>
          </div>
          <div class="card mos">
            <div class="title">安全邊際</div>
            <div class="value" id="resMOS">—</div>
          </div>
          <div class="card action" id="resAction">—</div>
          <div class="card ev">
            <div class="title">企業價值 (EV)</div>
            <div class="value" id="resEVCard">—</div>
          </div>
          <div class="card equity">
            <div class="title">股權價值</div>
            <div class="value" id="resEquityCard">—</div>
          </div>
        </div>

        <div id="gaugeWrap" class="gauge hidden"></div>
        <div class="tool-row"><button id="btnSaveGauge" class="secondary">下載儀表圖（PNG）</button></div>

        <section class="projections" id="projectionsBlock">
          <h2>查看 10 年 FCF 預估與折現</h2>
          <div class="tool-row" style="justify-content:flex-end"><button id="btnSaveTable" class="secondary">下載表格（PNG）</button></div>
          <div id="projectionTable"></div>
        </section>

        <section class="chart-wrap">
          <h3>自由現金流</h3>
          <div id="chart-fcf" class="chart"></div>
        </section>

        <section class="chart-wrap">
          <h3>總和（最後一年含終值）</h3>
          <div id="chart-sum" class="chart"></div>
        </section>

        <section class="chart-wrap">
          <h3>FCF Margin</h3>
          <div id="chart-margin" class="chart"></div>
        </section>
      </section>
    </main>

    <footer class="container footer">
      <small>僅供估值研究，非投資建議。</small><br />
      <small>估值方式參考：YouTube 頻道「美股咖啡館」— <a href="https://www.youtube.com/@nick_valueinvesting" target="_blank" rel="noopener noreferrer">@nick_valueinvesting</a>。感謝分享與啟發！</small>
    </footer>

    <script src="app.js"></script>
  </body>
  </html>
